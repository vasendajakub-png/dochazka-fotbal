<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Doch√°zka ‚Äì fotbalov√Ω klub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; }
    h1, h2, h3 { margin-top: 20px; }
    input, select, button { margin: 5px 0; padding: 8px; width: 100%; }
    button { background: #2e7d32; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button.delete { background: #c62828; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 10px; margin-top: 15px; }
    @media (min-width: 700px) {
      input, select, button { width: auto; }
    }
  </style>
</head>
<body>

<h1>‚öΩ Doch√°zkov√Ω syst√©m</h1>

<div class="card">
<h2>1Ô∏è‚É£ Hr√°ƒçi</h2>
<input id="playerName" placeholder="Jm√©no hr√°ƒçe" />
<button onclick="addPlayer()">P≈ôidat hr√°ƒçe</button>
<ul id="playerList"></ul>
</div>

<div class="card">
<h2>2Ô∏è‚É£ Ud√°losti</h2>
<input id="eventName" placeholder="N√°zev (nap≈ô. Tr√©nink)" />
<select id="eventType">
  <option value="Tr√©nink">Tr√©nink</option>
  <option value="Z√°pas">Z√°pas</option>
</select>
<input type="date" id="eventDate" />
<button onclick="addEvent()">Vytvo≈ôit ud√°lost</button>
<ul id="eventList"></ul>
</div>

<div class="card">
<h2>3Ô∏è‚É£ Doch√°zka</h2>
<div id="attendance"></div>
</div>

<div class="card">
<h2>4Ô∏è‚É£ Statistiky</h2>
<label>Mƒõs√≠c:</label>
<input type="month" id="monthFilter" onchange="renderSummary()" />
<button onclick="exportToExcel()">üì§ Export do Excelu</button>
<div id="summary"></div>
</div>

<script>
let players = JSON.parse(localStorage.getItem('players')) || [];
let events = JSON.parse(localStorage.getItem('events')) || [];

const STATUS = ['P≈ô√≠tomen', 'Omluven', 'Neomluven', 'Zranƒõn√≠'];

function save() {
  localStorage.setItem('players', JSON.stringify(players));
  localStorage.setItem('events', JSON.stringify(events));
}

function addPlayer() {
  const name = playerName.value.trim();
  if (!name) return;
  players.push(name);
  playerName.value = '';
  save();
  render();
}

function deletePlayer(index) {
  if (!confirm('Opravdu smazat hr√°ƒçe?')) return;
  const player = players[index];
  players.splice(index, 1);
  events.forEach(e => delete e.attendance[player]);
  save();
  render();
}

function addEvent() {
  const name = eventName.value;
  const type = eventType.value;
  const date = eventDate.value;
  if (!name || !date) return;
  events.push({ name, type, date, attendance: {} });
  eventName.value = '';
  save();
  render();
}

function render() {
  playerList.innerHTML = players.map((p, i) => 
    `<li>${p} <button class="delete" onclick="deletePlayer(${i})">‚úñ</button></li>`
  ).join('');

  eventList.innerHTML = events.map((e, i) => 
    `<li><button onclick="showAttendance(${i})">${e.date} ‚Äì ${e.name} (${e.type})</button></li>`
  ).join('');

  renderSummary();
}

function showAttendance(index) {
  const e = events[index];
  let html = `<h3>${e.date} ‚Äì ${e.name} (${e.type})</h3><table><tr><th>Hr√°ƒç</th><th>Stav</th></tr>`;

  players.forEach(p => {
    const current = e.attendance[p] || '';
    html += `<tr><td>${p}</td><td><select onchange="setAttendance(${index}, '${p}', this.value)">
      <option value="">‚Äî</option>
      ${STATUS.map(s => `<option ${s===current?'selected':''}>${s}</option>`).join('')}
    </select></td></tr>`;
  });

  html += '</table>';
  attendance.innerHTML = html;
}

function setAttendance(eventIndex, player, status) {
  events[eventIndex].attendance[player] = status;
  save();
  renderSummary();
}

function renderSummary() {
  const month = monthFilter.value;
  let filteredEvents = month ? events.filter(e => e.date.startsWith(month)) : events;

  let html = '<table><tr><th>Hr√°ƒç</th><th>Tr√©ninky (%)</th><th>Z√°pasy (%)</th><th>Celkem (%)</th></tr>';

  players.forEach(p => {
    const valid = s => s === 'P≈ô√≠tomen';
    const train = filteredEvents.filter(e => e.type === 'Tr√©nink');
    const match = filteredEvents.filter(e => e.type === 'Z√°pas');

    const tp = train.filter(e => valid(e.attendance[p])).length;
    const mp = match.filter(e => valid(e.attendance[p])).length;

    const tPct = train.length ? Math.round(tp / train.length * 100) : 0;
    const mPct = match.length ? Math.round(mp / match.length * 100) : 0;
    const totalPct = filteredEvents.length ? Math.round((tp + mp) / filteredEvents.length * 100) : 0;

    html += `<tr><td>${p}</td><td>${tPct}</td><td>${mPct}</td><td>${totalPct}</td></tr>`;
  });

  html += '</table>';
  summary.innerHTML = html;
}

function exportToExcel() {
  let rows = [['Datum','Ud√°lost','Typ','Hr√°ƒç','Stav']];
  events.forEach(e => {
    players.forEach(p => {
      rows.push([e.date, e.name, e.type, p, e.attendance[p] || '']);
    });
  });

  let csv = rows.map(r => r.join(';')).join('\n');
  let blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  let link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'dochazka.csv';
  link.click();
}

render();
</script>

</body>
</html>
